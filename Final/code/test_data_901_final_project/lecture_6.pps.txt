Προγραμματισμός II
Δείκτες και συναρτήσεις
Έως τώρα περνούσαμε τους δείκτες ως ορίσματα σε συναρτήσεις.
Μπορούμε όμως να επιστρέφουμε δείκτες;
Όταν επιστρέφεται ένας δείκτης, θα πρέπει να δείχνει σε δεδομένα της καλούσας συνάρτησης.
Δεν πρέπει ποτέ να επιστρέφετε δείκτη που δείχνει σε τοπική μεταβλητή της καλούμενης συνάρτησης, γιατί όταν τερματισθεί η συνάρτηση οι τοπικές μεταβλητές εξαφανίζονται.
Μπορούμε να χρησιμοποιήσουμε δείκτη για να αλλάξουμε το περιεχόμενο της θέσης στην οποία δείχνει, αλλά δεν πρέπει να αλλάξουμε τον ίδιο το δείκτη μέσα στην καλούμενη συνάρτηση.
Aντιγράφει την τιμή του pscore (δηλαδή τη διεύθυνση στην οποία δείχνει) στον ptr
ΚΑΚΟ! Όταν τυπώνει η συνάρτηση τελειώνει και ο ptr εξαφανίζεται.
Ο pscore είναι ό,τι ήταν και πριν την κλήση της συνάρτησης print.
ΛΑΘΟΣ! Όταν τελειώνει η incr, η x εξαφανίζεται και η τιμή της χάνεται.
Ωστόσο, πίσω στη συνάρτηση ο pscore θα δείχνει στη διεύθυνση που επέστρεψε από τη συνάρτηση αλλά θα υπάρχει «σκουπίδι» (junk) σ’ αυτή τη διεύθυνση, εφόσον το x έχει εξαφανισθεί.
(Υπενθύμιση) Συνάρτηση και Πίνακες
Εάν η πραγματική παράμετρος είναι όνομα πίνακα (πχ. key), στέλνει τη διεύθυνση του πρώτου byte του πίνακα.
Η παράμετρος στη δήλωση της συνάρτησης είναι ένα όνομα τοπικού πίνακα (π.χ. x). Κρατά ένα αντίγραφο της ίδιας διεύθυνσης αλλά χρησιμοποιεί διαφορετικό όνομα.
Κλήση κατ’ αξία
Το όρισμα 4 αντιγράφει μία ΤΙΜΗ στη συνάρτηση.
Η διαδικασία αυτή ονομάζεται κλήση κατ’ αξία (call by value).
Παράμετρος συνάρτησης
Πραγματική παράμετρος
Το όρισμα key αντιγράφει τη ΔΙΕΥΘΥΝΣΗ σε μία συνάρτηση.
Η συνάρτηση χρησιμοποιεί αυτή τη διεύθυνση για να βρει το προς χρήση δεδομένο.
Κλήση κατ’ αναφορά
Όταν τα ορίσματα είναι πίνακες, περνιούνται στις συναρτήσεις ‘κατ’ αναφορά’ (call by reference) — και μπορεί να είναι ΤΟΣΟ είσοδοι ΟΣΟ και έξοδοι.
(τόσο η main() όσο και η setKeyA() μπορούν να θέσουν τιμές σε στοιχεία πινάκων).
Οι δείκτες επιτρέπουν να περνάμε ΟΠΟΙΟΔΗΠΟΤΕ δεδομένο κατ’αναφορά
Παράδειγμα: αλλάζουμε την setKeyA έτσι ώστε να δέχεται ως ορίσματα μόνο δείκτες και διευρύνονται οι δυνατότητες.(αλλάζουμε το όνομα σε setKeyP)
Συναρτήσεις και Δείκτες
Οι πραγματικές παράμετροι που είναι δείκτες αντιγράφουν μία διεύθυνση στις παραμέτρους της συνάρτησης, αλλά εάν αλλαχθεί η παράμετρος στη συνάρτηση (δηλ. η διεύθυνση) ΔΕ θα αλλαχθεί η πραγματική παράμετρος !!
Ο δείκτης ως όρισμα
Ταχύ, αποδοτικό
(αντιγράφει μόνο τη διεύθυνση, όχι όλα τα δεδομένα)
Ισχυρό: μπορεί να είναι είσοδος, έξοδος ή και τα δύο
!!ΚΙΝΔΥΝΟΣ!!
Τι γίνεται όταν έχουμε άκυρα ορίσματα;
Απάντηση: Να αναμένετε το χείριστο χάος–το λανθασμένο στοιχείο να αποθηκεύεται τη λάθος στιγμή σε λάθος θέση!!
Συναρτήσεις με τύπο επιστροφής δείκτη
Οι συναρτήσεις των οποίων ο τύπος επιστροφής είναι δείκτης;
ΠΩΣ: η δήλωση της συνάρτησης μοιάζει:
Όλες οι μεταβλητές της συνάρτησης είναι τοπικές και προσωρινές.
Μπορεί να εξαφανισθούν όταν φύγουμε από τη συνάρτηση.
Μην επιστρέφετε δείκτες σε μη ορισμένες μεταβλητές!
Να μην επιστρέφετε ποτέ δείκτες ΕΚΤΟΣ εάν χρησιμοποιείτε τη λέξη κλειδί “static”
Παράδειγμα static
... (κώδικας που δεν αλλάζει τον pKey) ...
ΣΦΑΛΜΑ
ΔΙΟΤΙ:
Στην έξοδο η προσωρινή μεταβλητή i και ο πίνακας keep είναι ακαθόριστοι
Η λέξη κλειδί ‘static’ διατηρεί τον πίνακα keep, ακόμη και μετά την έξοδο από τη συνάρτηση.
ΣΩΣΤΟ
επιστροφή(δείκτης)Πάντοτε έλεγξε για static!
Παράδειγμα: Tο ακόλουθο πρόγραμμα αφορά σε δείκτες που δείχνουν σε δομές και παρουσιάζει συγκριτικά τον τρόπο λειτουργίας της κλήσης κατ’ αξία και της κλήσης κατ’ αναφορά
Αποτέλεσμα:
Παράδειγμα:
Να αναπτυχθεί πρόγραμμα που να λαμβάνει από το πληκτρολόγιο τα στοιχεία ενός εργαζόμενου και να δημιουργεί πίνακα εργαζόμενων, με τύπο δεδομένου κατάλληλη δομή.
Η διαδικασία θα επαναλαμβάνεται για 10 διαφορετικούς εργαζόμενους, όσο είναι και το μέγεθος του πίνακα.
Οι πληροφορίες που διαβάζονται για κάθε εργαζόμενο είναι:
Ονοματεπώνυμο: Όνομα και επώνυμο ξεχωριστά (σε μεταβλητή τύπου δομής)
Διεύθυνση: Όνομα οδού, αριθμός οδού, πόλη, ταχ.
Κώδικας (σε μεταβλητή τύπου δομής)
Τηλέφωνα: Τηλέφωνο εργασίας, κινητό (σε μεταβλητή τύπου δομής)
Θέση: Τίτλος, κωδικός αριθμός εργαζόμενου, τομέας της επιχείρησης στον οποίο εργάζεται, αριθμός γραφείου, ονοματεπώνυμο προϊσταμένου, ημερομηνία πρόσληψης (ημέρα, μήνας, έτος), μισθός (σε μεταβλητή τύπου δομής – θα απαιτηθεί ένθετη δομή για την ημερομηνία πρόσληψης)
Στη συνέχεια να δίνεται κάποιος κωδικός αριθμός εργαζόμενου από το πληκτρολόγιο και να αναζητείται στον πίνακα.
Αν υπάρχει, τότε να εμφανίζονται στην οθόνη οι πληροφορίες του αντίστοιχου εργαζόμενου, αλλιώς να εμφανίζεται ένα ανάλογο μήνυμα.
Αποτελέσματα:
