ΚΑΤΑΧΩΡΗΤΕΣ- STATUS REGISTER
ΕΝΟΤΗΤΑ 14Η
ΜΙΚΡΟΕΛΕΓΚΤΕΣ Β΄
Βασικοί ειδικοί καταχωρητές του PIC16F877
Xρονισμός - Ο Timer0
Σήματα διακοπής
ADC και UART
DSP επεξεργαστές
ΤΡΟΠΟΙ ΔΙΕΥΘΥΝΣΙ-
ΟΔΟΤΗΣΗΣ
ΒΑΣΙΚΕΣ ΕΝΤΟΛΕΣ ΑΝΤΙΓΡΑΦΗΣ ΚΑΙ ΜΕΤΑΦΟΡΑΣ ΔΕΔΟΜΕΝΩΝ ΤΟΥ ΜΙΚΡΟΕΛΕΓΚΤΗ PIC16F877
αντιγράφει το περιεχόμενο του καταχωρητή εργασίας W στον καταχωρητή Reg.
αντιγράφει το περιεχόμενο του καταχωρητή Reg στον καταχωρητή εργασίας W.
μεταφέρει την ποσότητα k στον καταχωρητή εργασίας W, με τη διαφορά, ότι εδώ το k είναι ο συγκεκριμένος αριθμός και δεν αντιπροσωπεύει μία θέση μνήμης, όπως προηγουμένως ο Reg.
Με βάση τα παραπάνω, η εντολή
μεταφέρει τον δεκαεξαδικό αριθμό 0C στον καταχωρητή εργασίας W, ενώ η εντολή
θα μεταφέρει στον W όχι το περιεχόμενο της διεύθυνσης Reg, αλλά την ίδια τη διεύθυνση Reg.
Αν, λοιπόν, φανταστούμε ότι ορίσαμε στη διεύθυνση hex0F τον καταχωρητή START (START equ 0F), τότε η εντολή
έχει σαν αποτέλεσμα να μεταφερθεί στον καταχωρητή εργασίας W o αριθμός 0F, ενώ η εντολή
αντιγράφει στον W το περιεχόμενο της διεύθυνσης 0F.
ΚΑΤΑΧΩΡΗΤΕΣ- OPTION REGISTER
Θέση των ειδικών καταχωρητών στον πίνακα της μνήμης
ΚΑΤΑΧΩΡΗΤΕΣ ΕΛΕΓΧΟΥ ΘΥΡΩΝ
ΧΡΟΝΙΣΜΟΣ
Διάρκεια κύκλου εντολής = 4 / (Συχνότητα εξωτερικού κρυστάλλου )
Τυπική συχνότητα λειτουργίας των μικροελεγκτών PIC είναι 4ΜΗz, οπότε η διάρκεια κάθε κύκλου εντολής είναι 1μsec.
Για κρύσταλλο 8MHz η διάρκεια του κύκλου εντολής είναι 0,5 μsec.
Χρόνος εκτέλεσης ομάδας εντολών
Αριθμός εντολών * Χρόνος εκτέλεσης εντολής
TIMER0, τρόποι λειτουργίας
α) Ως χρονιστής (timer): Στην περίπτωση αυτή η πηγή χρονισμού είναι ο εσωτερικός κύκλος των εντολών.
Το περιεχόμενο του Timer0 σε λειτουργία χρονιστή αυξάνει κατά ένα σε κάθε κύκλο εντολής.
Ο κύκλος της εντολής διαρκεί όσο η περίοδος του εξωτερικού κρυστάλλου επί τέσσερα (4*fosc). H αντίστοιχη συχνότητα είναι ίση με την συχνότητα του κρυστάλλου διά 4.
Χρησιμοποιώντας τον TMR0 σε λειτουργία εσωτερικού χρονισμού, έχουμε στη διάθεσή μας ένα αρκετά αξιόπιστο σήμα χρονισμού που μπορεί να χρησιμοποιηθεί για τον ακριβή προσδιορισμό χρονικών διαστημάτων.
β) Ως απαριθμητής (counter): Στην περίπτωση αυτή χρησιμοποιείται ένας εξωτερικός παλμός χρονισμού.
Το εξωτερικό σήμα χρονισμού συνδέεται με τον ακροδέκτη TOCKI (RΑ4). Η χρήση εξωτερικής πηγής χρονισμού επιτρέπει την απαρίθμηση εξωτερικών συμβάντων, με τη μορφή παλμών.
To περιεχόμενο του Timer0 αυξάνει κατά ένα σε κάθε παλμό της εξωτερικής πηγής χρονισμού.
Και στις δύο περιπτώσεις, ο TMR0 μετρά στο δεκαεξαδικό σύστημα από την αρχική τιμή που καταχωρήσαμε έως 0xFF.
Διαιρέτης συχνότητας (PRESCALER)
Ο διαιρέτης συχνότητας ρυθμίζεται με τα τρία πρώτα bits του καταχωρητή OPTION
Bits 7-6: Δεν έχουν σημασία για την λειτουργία του χρονιστή (τα θέτουμε 11).
T0CS: Επιλογή πηγής ρολογιού
1 = Πηγή συνδεδεμένη στον ακροδέκτη T0CKI (Λειτουργία μετρητή παλμών)
0 = Εσωτερική πηγή ρολογιού (Λειτουργία χρονιστή).
T0CE: Επιλογή θετικού ή αρνητικού μετώπου παλμού (αναφέρεται σε εξωτερική πηγή χρονισμού)
1 = Αύξηση με κατερχόμενο μέτωπο του παλμού στον ακροδέκτη T0CLK
0 = Αύξηση με ανερχόμενο μέτωπο του παλμού στον ακροδέκτη T0CLK
PSA: "0", όταν θέλουμε να συνδέσουμε τον διαιρέτη συχνότητας.
"1", όταν θέλουμε να αποσυνδέσουμε τον διαιρέτη συχνότητας.
PS2-PS0: Επιλογή λόγου διαίρεσης
ΠΑΡΑΔΕΙΓΜΑ ΠΡΟΓΡΑΜΜΑΤΙΣΜΟΥ ΤΟΥ ΤIMER0
Org 0 ;Το πρόγραμμα ξεκινά από τη θέση ;μνήμης προγράμματος 0
bsf STATUS, RP0 ;Μεταβαίνουμε στην σελίδα 1 μνήμης
movlw b'11010001' ;Διαίρεση συχνότητας διά 4
movwf OPTION_REG ;Εγγράφουμε τον OPTION REG
bcf STATUS, RP0 ;Μεταβαίνουμε στην σελίδα 0 μνήμης
movlw 0F0h ; Θέτουμε στον TMR0 αρχική τιμή 240
bcf INTCON, T0IF ;Μηδενίζουμε την σημαία T0IF
loop goto loop ;Βρόχος αναμονής
ΕΦΑΡΜΟΓΗ ΧΡΟΝΙΣΜΟΥ – ΜΕΤΡΗΣΗ ΔΕΥΤΕΡΟΛΕΠΤΩΝ
CENT equ 20h ; Δίνουμε στη θέση μνήμης 20h το όνομα CENT
SEC equ 21h ; Δίνουμε στη θέση μνήμης 21h το όνομα SEC
movwf SEC ; Ορίζουμε χρόνο 5 sec και το αποθηκεύουμε στην θέση SEC
clrf CENT ; Μηδενίζουμε την θέση CENT (εκατοστά του δευτερολέπτου)
bsf STATUS, RP0 ; Μεταβαίνουμε στην σελίδα μνήμης 1
movwf TRISB ; Κάνουμε τα δύο χαμηλότερα bits της θύρας B έξοδο
movwf OPTION_REG ; Oρίζουμε διαίρεση συχνότητας 1/256 PS2:PS0=111
bcf STATUS, RP0 ; Επιστρέφουμε στην σελίδα μνήμης 0
movlw b'00000010' ; Ανάβουμε το δεύτερο LED της PORTB
ΣΥΝΕΧΕΙΑ…
movwf TMR0 ; Χρόνος=(256-178)*256*4/8 σε μsec (=0,01 sec)
bcf INTCON, T0IF ; Μηδενίζουμε τη σημαία T0IF
loop2 btfss INTCON, T0IF ; Αναμονή 0,01 sec
goto loop1 ; Επαναλαμβάνει την αναμονή 100 φορές
goto loop1 ; Επαναλαμβάνει τη συνολική αναμονή SEC φορές
movwf PORTB ; Ανάβει το πρώτο LED
ΣΗΜΑΤΑ ΔΙΑΚΟΠΗΣ
Ο μικροελεγκτής PIC16F877 μπορεί να δεχτεί σήματα διακοπών κυρίως από τις εξής πηγές:
Εξωτερική διακοπή από τον ακροδέκτη RB0/INT.
Υπερχείλιση του απαριθμητή-χρονιστή TMR0.
Κάποια αλλαγή της κατάστασης των ακροδεκτών RB7-RB4 της θύρας B.
Ο καταχωρητής που ρυθμίζει την ενεργοποίηση των διακοπών και καταγράφει ποιες διακοπές σημειώθηκαν είναι ο καταχωρητής INTCON (Interrupt Control).
O ενσωματωμένος πολυπλέκτης 8 καναλιών
και το κύκλωμα ADC του μικροελεγκτή
Ο ρυθμός μετατροπής εξαρτάται από τη συχνότητα του κεντρικού ρολογιού: ΤAD=12Τosc
Λειτουργία λήψης δεδομένων από την
ενσωματωμένη UART
Λειτουργία αποστολής δεδομένων από την
Τα bits που ελέγχουν τη διαδικασία βρίσκονται σε ορισμένους ειδικούς καταχωρητές του μικροελεγκτή.
Ολοκληρωμένη εφαρμογή: απλός βιομηχανικός αυτοματισμός
RA1, RA2: Σύνδεση αναλογικών καναλιών εισόδου.
RX/TX σύνδεση μετατροπέα στάθμης και στη συνέχεια σειριακού καλωδίου.
Συστήματα επεξεργαστών DSP
Τυπική διάταξη για επεξεργασία σημάτων
Μέτρηση των επιδόσεων (π.χ. συχνοτική απόκριση) συστήματος για ψηφιακή επεξεργασία σημάτων
Λογισμικό για ανάπτυξη και αποσφαλμάτωση κώδικα για DSP επεξεργαστές
